---
title: "Modeling"
author: "Sardhendu Mishra"
date: "4/15/2018"
output: pdf_document
---

```{r}
outpath = '/Users/sam/All-Program/App-DataSet/DataScienceProjects/CreditCardFraud/'
dat = read.csv(paste(outpath,"sample_credit_fraud.csv"))
dim(dat)
head(dat)
```

```{r}
library('rjags')
model_string = "model{
  for (i in 1:length(y)){
    y[i] ~ dbern(p[i])
    logit(p[i]) = b0 + b[1]*V1[i] + b[2]*V2[i] + b[3]*V3[i] + b[4]*V4[i] + b[5]*V5[i] + b[6]*V6[i] + b[7]*V7[i] + b[8]*V8[i] + b[9]*V9[i] + b[10]*V10[i] + b[11]*V11[i] + b[12]*V12[i] + b[12]*V12[i] + b[13]*V13[i] + b[14]*V14[i] + b[15]*V15[i] + b[16]*V16[i] + b[17]*V17[i] + b[18]*V18[i] + b[19]*V19[i] + b[20]*V20[i] + b[21]*V21[i] + b[22]*V22[i] + b[23]*V23[i] + b[24]*V24[i] + b[25]*V25[i] + b[26]*V26[i] + b[27]*V27[i] + b[28]*V28[i]
  }
  
  # We chouse priors for the parameters
  b0 ~ dnorm(1.0, 1/25)               # Equivallent to a non-informative prior
  for (j in 1:28){  
    b[j] ~ dnorm(0.0, 1/25.0) 
  }
}"
```

```{r}
set.seed(632)

# Jags takes input as list
data_jags = list(y=dat$Class, V1=dat[,'V1'], V2=dat[,'V2'], V3=dat[,'V3'], V4=dat[,'V4'], V5=dat[,'V5'], V6=dat[,'V6'], V7=dat[,'V7'], V8=dat[,'V8'], V9=dat[,'V9'], V10=dat[,'V10'], V11=dat[,'V11'], V12=dat[,'V12'], V13=dat[,'V13'], V14=dat[,'V14'], V15=dat[,'V15'], V16=dat[,'V16'], V17=dat[,'V17'], V18=dat[,'V18'], V19=dat[,'V19'], V20=dat[,'V20'], V21=dat[,'V21'], V22=dat[,'V22'], V23=dat[,'V23'], V24=dat[,'V24'], V25=dat[,'V25'], V26=dat[,'V26'],V27=dat[,'V27'], V28=dat[,'V28'])

# Parameters that we would wanna monitor
params = c('b0','b')

mod3 = jags.model(textConnection(model_string), data=data_jags, n.chains = 3)

# Burn-in period
update(mod3, 1e3)

mod3_sim = coda.samples(model=mod3, variable.names = params, n.iter = 5e3)
```


```{r, fig.width=10, fig.height=10}
pdf("modeled_mcmc_trace.pdf",width=20,height=15)
plot(mod3_sim)
dev.off
```

```{r}
gelman.diag(mod3_sim)
```
```{r}
autocorr.diag(mod1_sim)
pdf("modeled_acorr.pdf",width=20,height=15)
autocorr.plot(mod1_sim)
dev.off
```

```{r}
dic1 = dic.samples(mod3, n.iter=1e3)
dic1
```